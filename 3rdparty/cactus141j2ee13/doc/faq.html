<HTML><HEAD><TITLE>FAQ</TITLE></HEAD><BODY alink="#023264" bgcolor="#ffffff" leftmargin="4" link="#525D76" marginheight="4" marginwidth="4" text="#000000" topmargin="4" vlink="#023264"><TABLE border="0" cellpadding="0" cellspacing="0" width="100%"><TR><TD align="left" valign="top"><A href="http://jakarta.apache.org/index.html"><IMG border="0" hspace="0" src="./images/jakarta-logo.gif" vspace="0"></A></TD><TD align="left" bgcolor="#ffffff" valign="middle" width="100%"><IMG align="right" alt="FAQ" border="0" hspace="0" src=".//images/logocactus.gif" vspace="0"></TD></TR><TR><TD colspan="2" height="2" width="100%"><HR noshade="" size="1"></TD></TR></TABLE><TABLE border="0" cellpadding="0" cellspacing="0" width="100%"><TR><TD valign="top" width="1%"></TD><TD nowrap="1" valign="top" width="14%"><FONT size="-2">
              Last update : August 31 2002</FONT><BR><FONT size="-2">
              Doc for : v1.4.1</FONT><BR><FONT face="arial,helvetica,sanserif">

  <BR><FONT color="#000000" size="+1">About</FONT><BR><FONT size="-1">
    <LI><A href="./index.html"><FONT size="-1">What is Cactus ?</FONT></A></LI>
    <LI><A href="./news.html"><FONT size="-1">News</FONT></A></LI>
    <LI><A href="./changes.html"><FONT size="-1">Changes</FONT></A></LI>
    <LI><A href="./features.html"><FONT size="-1">Features/Status</FONT></A></LI>
    <LI><A href="./goals.html"><FONT size="-1">Goals</FONT></A></LI>
    <LI><A href="./todo.html"><FONT size="-1">Roadmap/Todo</FONT></A></LI>
    <LI><A href="./contributors.html"><FONT size="-1">Contributors</FONT></A></LI>
    <LI><A href="./contributing.html"><FONT size="-1">Contributing</FONT></A></LI>
    <LI><A href="./users.html"><FONT size="-1">Cactus Users</FONT></A></LI>
    <LI><A href="./testedon.html"><FONT size="-1">Tested on ...</FONT></A></LI>
    <LI><A href="./license.html"><FONT size="-1">License</FONT></A></LI>
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Downloads</FONT><BR><FONT size="-1">
    <LI><A href="./downloads.html"><FONT size="-1">Downloads</FONT></A></LI>
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Documentation</FONT><BR><FONT size="-1">
    <LI><A href="./how_it_works.html"><FONT size="-1">How it works ?</FONT></A></LI>
    
    <LI><A href="./getting_started.html"><FONT size="-1">Getting Started</FONT></A></LI>
    <LI><A href="./mockobjects.html"><FONT size="-1">Mock vs Container</FONT></A></LI>
    <LI><A href="./javadoc.html"><FONT size="-1">Javadocs</FONT></A></LI>
    
    
    <LI><A href="./faq.html"><FONT size="-1">FAQ</FONT></A></LI>
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Howto Guides</FONT><BR><FONT size="-1">
    <LI><A href="./howto_classpath.html"><FONT size="-1">Classpath Howto</FONT></A></LI>
    <LI><A href="./howto_config.html"><FONT size="-1">Config Howto</FONT></A></LI>
    <LI><A href="./howto_migration.html"><FONT size="-1">Migration Howto</FONT></A></LI>

    
    <LI><A href="./howto_testcase.html"><FONT size="-1">TestCase Howto</FONT></A></LI>
    
    
    

    <LI><A href="./howto_jsp.html"><FONT size="-1">Jsp Howto</FONT></A></LI>
    <LI><A href="./howto_runner.html"><FONT size="-1">Runner Howto</FONT></A></LI>
    <LI><A href="./howto_security.html"><FONT size="-1">Security Howto</FONT></A></LI>

    
    <LI><A href="./howto_ant.html"><FONT size="-1">Ant Howto</FONT></A></LI>
    
    
    

    <LI><A href="./howto_httpunit.html"><FONT size="-1">HttpUnit Howto</FONT></A></LI>
    <LI><A href="./howto_sample.html"><FONT size="-1">Sample Howto</FONT></A></LI>

    
    <LI><A href="./howto_ejb.html"><FONT size="-1">EJB Howto</FONT></A></LI>
    

    
    <LI><A href="./howto_ide.html"><FONT size="-1">IDE Howto</FONT></A></LI>
    
    
    
    

    <LI><A href="./howto_tomcat.html"><FONT size="-1">Tomcat Howto</FONT></A></LI>

    <LI><A href="./howto_junitee.html"><FONT size="-1">JUnitEE Howto</FONT></A></LI>
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Support</FONT><BR><FONT size="-1">
    <LI><FONT size="-1"><A href="http://jakarta.apache.org/site/bugs.html" target="">Bug database</A></FONT></LI>
    <LI><A href="./mailinglist.html"><FONT size="-1">Mailing list</FONT></A></LI>
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Misc.</FONT><BR><FONT size="-1">
    <LI><A href="./cactusname.html"><FONT size="-1">Why the name ?</FONT></A></LI>
    <LI><A href="./logos.html"><FONT size="-1">Logo Challenge</FONT></A></LI>
    <LI><A href="./resources.html"><FONT size="-1">Resources</FONT></A></LI>
    <LI><A href="./coverage.html"><FONT size="-1">Test Coverage</FONT></A></LI>
    
    
    
    <LI><FONT size="-1"><A href="http://jakarta.apache.org/cactus/stats/index.html" target="">Stats</A></FONT></LI>
    
  </FONT><BR>

  <BR><FONT color="#000000" size="+1">Developers</FONT><BR><FONT size="-1">
    <LI><FONT size="-1"><A href="http://jakarta.apache.org/site/cvsindex.html" target="">CVS</A></FONT></LI>
    <LI><A href="./coding_conventions.html"><FONT size="-1">Coding Conventions</FONT></A></LI>
    <LI><A href="./build_result.html"><FONT size="-1">Build results</FONT></A></LI>
    <LI><A href="./release_checklist.html"><FONT size="-1">Release Checklist</FONT></A></LI>
  </FONT><BR>

</FONT></TD><TD align="left" valign="top" width="*"><TABLE border="0" cellpadding="3" cellspacing="0"><TR><TD><BR>
  

  

    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>FAQ Content</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
      <BLOCKQUOTE><UL>

        <LI>
          <A href="#faq1">&quot;Can't find resource for cactus&quot; error
          message</A>
        </LI>
        <LI>
          <A href="#faq2">How can I have a web.xml that is valid both for
          testing and for production ?</A>
        </LI>
        <LI>
          <A href="#faq3">I'm getting a
          <CODE><FONT face="courier, monospaced">java.io.StreamCorruptedException: InputStream does not contain a
          serialized object</FONT></CODE> error. What does it mean ?</A>
        </LI>
        <LI>
          <A href="#faq4">How can I test the chaining of several HTTP
          requests ?</A>
        </LI>
        <LI>
          <A href="#faq5">The Ant runservertests task hangs when my server
          is started</A>
        </LI>
        <LI>
          <A href="#faq6">I'm getting a
          &quot;<CODE><FONT face="courier, monospaced">not a valid response</FONT></CODE> error message. What does it
          mean ?</A>
        </LI>
        <LI>
          <A href="#faq7">How to send multipart/form-data ?</A>
        </LI>
        <LI>
          <A href="#faq8">I get a &quot;java.lang.ClassCastException: 
          org.apache.commons.logging.impl.LogFactoryImpl&quot; error when I use 
          a JUnit TestRunner different from TextTestRunner</A>
        </LI>
      </UL></BLOCKQUOTE>
    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq1"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>Can't find resource for cactus error message</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <P align="justify">
        If you get the following stack trace :
      </P>

<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
java.lang.ExceptionInInitializerError: java.util.MissingResourceException:
  Can't find bundle for base name cactus, locale en_GB
at java.util.ResourceBundle.throwMissingResourceException(ResourceBundle.java:707)
at java.util.ResourceBundle.getBundleImpl(ResourceBundle.java:679)
at java.util.ResourceBundle.getBundle(ResourceBundle.java:546)
</PRE></TD></TR></TABLE></DIV>

      <P align="justify">
        it simply means that you have not put the cactus.properties file in
        your CLASSPATH (i.e. the directory which contains this file should
        be in the CLASSPATH). This file is the Cactus configuration file and
        is required. Check the Cactus
        <A href="howto_config.html">Configuration Howto</A> page for
        more information.
      </P>
    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq2"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>How can I have a web.xml that is valid both for testing and for production ?</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          Cactus needs to have a few entries set in the <CODE><FONT face="courier, monospaced">web.xml</FONT></CODE>
          file (redirector definition and mappings mostly). The application to
          test also needs its own entries. What would be nice would be to be
          able to use the same <CODE><FONT face="courier, monospaced">web.xml</FONT></CODE> file in the build process
          for both application testing and deployment to production.
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>
      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
            Here's how I accomplished conditional inclusion
            of Cactus web.xml configuration.  My web.xml file is capable of
            working standalone without requiring any filtered copy to work.
            In Ant I'm doing this:
        </P>
<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
&lt;!-- Activate the Cactus web.xml configuration --&gt;
&lt;copy todir=&quot;${admin.build.dir}/WEB-INF&quot;
      file=&quot;web/admin/WEB-INF/web.xml&quot;
      overwrite=&quot;yes&quot;&gt;
  &lt;filterset&gt;
    &lt;filter token=&quot;start.cactus.config&quot; value=&quot;--&amp;gt;&quot; /&gt;
    &lt;filter token=&quot;end.cactus.config&quot; value=&quot;&amp;lt;!--&quot; /&gt;
  &lt;/filterset&gt;
&lt;/copy&gt;</PRE></TD></TR></TABLE></DIV>

        <P align="justify">
          In <CODE><FONT face="courier, monospaced">web.xml</FONT></CODE> I have this:
        </P>

<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
&lt;!-- Cactus configuration
Note: Do not place any XML comments in this Cactus configuration section
(Ant's filtered copy is used to activate this configuration when the test
web application is built)
--&gt;
&lt;!-- Begin Cactus Configuration @start.cactus.config@
&lt;servlet&gt;
  &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet&gt;
    &lt;servlet-name&gt;JspRedirector&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/somewhere/jspRedirector.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletRedirector/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;JspRedirector&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/JspRedirector/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

@end.cactus.config@ End Cactus Configuration --&gt;
</PRE></TD></TR></TABLE></DIV>

      </FONT></TD></TR></TABLE></DIV><BR>

    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq3"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>I'm getting a java.io.StreamCorruptedException error. What does it mean ?</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <P><TABLE border="0" cellpadding="0" cellspacing="3" width="100%"><TR><TD valign="top" width="28"><IMG alt="Note" border="0" height="29" hspace="0" src="images/note.gif" vspace="0" width="28"></TD><TD valign="top"><FONT color="#000000" face="arial,helvetica,sanserif" size="-1"><I>
        This error only appears for Cactus 1.3dev (before 21/04/2002) and
        below. Cactus 1.3 no longer uses a serialized object to return test
        result. It uses an XML string.
      </I></FONT></TD></TR></TABLE></P>

      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          This exception results when client-side Cactus code attempts to talk
          to a misconfigured installation of Cactus on the server side. The
          reason for the obscure exception is this: Cactus makes two requests
          to the server. In the first, the client-side test runner requests that
          such-and-such a test be run on the server (an oversimplification,
          please see: XXXX). Immediately after the response from the server
          the client code makes a second request, this time for the results of
          the server-side test. Cactus is supposed to send back a serialized
          Object containing the results. Cactus then attempts to deserialize
          this Object from the input stream in the response. If
          Cactus is installed properly on the server, this process
          works transparently. If not (for instance the second
          request does not even arrive at a Cactus redirector) then
          the response to the second request (which very well may be
          a 404 or 500 error) will not contain the object that
          client-cactus expects. This leads to the
          StreamCorruptedException.
        </P>
        <P align="justify">
          When troubleshooting this error, the most likely prospect
          is that the requests from client-Cactus are not even
          reaching server-Cactus. This can happen when the
          <CODE><FONT face="courier, monospaced">cactus.properties</FONT></CODE> contains a bad entry. For instance, I
          have run into this problem when building several different
          testing-applications. I tried to run my tests against
          <CODE><FONT face="courier, monospaced">http://localhost/webapp1/ServletRedirector/</FONT></CODE> when I needed
          to be running against
          <CODE><FONT face="courier, monospaced">http://localhost/webapp2/ServletRedirector/</FONT></CODE>. This can
          also happen if your web.xml file contains an error, or does not
          properly map the URLs contained in cactus.properties to the
          Cactus redirectors.
        </P>
        <P align="justify">
          A good way to check whether your requests are reaching a
          Cactus redirector is to manually enter in the URLs for all
          of the redirectors you use into the navigation bar of your
          web-browser. Actually the Cactus redirectors provide a URL just for
          that : <CODE><FONT face="courier, monospaced">http://localhost/webapp/ServletRedirector?Cactus_Service=RUN_TEST</FONT></CODE>
          (this also works for the other redirectors).
        </P>
        <P><TABLE border="0" cellpadding="0" cellspacing="3" width="100%"><TR><TD valign="top" width="28"><IMG alt="Note" border="0" height="29" hspace="0" src="images/note.gif" vspace="0" width="28"></TD><TD valign="top"><FONT color="#000000" face="arial,helvetica,sanserif" size="-1"><I>
          If you call <CODE><FONT face="courier, monospaced">http://localhost/webapp/ServletRedirector</FONT></CODE>
          directly, you'll get a 500 error and get a stack trace (in the log or
          along with your error page) that says <CODE><FONT face="courier, monospaced">Missing service
          name parameter [] in HTTP request.</FONT></CODE>. This is because the
          Cactus redirector expects HTTP parameter from the Cactus client side.
        </I></FONT></TD></TR></TABLE></P>
        <P align="justify">
          Another likely error is that your server-side classpath
          does not contain a copy of the cactus.jar. (Cactus is
          effectively not present on the server.) According to
          e-mails on the Cactus user list, the
          <CODE><FONT face="courier, monospaced">StreamCorruptedException</FONT></CODE> could also result when you are
          using the wrong version of the servlet.jar in some area
          (any version prior to 2.2, or using servlet.jar 2.2 with a
          Cactus-1.3 installation).
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>

    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq4"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>How can I test the chaining of several HTTP requests ?</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          Let's imagine that I have one servlet that performs an HTTP redirect
          to a JSP page (or to another servlet). How do I test it with Cactus ?
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>
      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          Short answer : you don't !
        </P>
        <P align="justify">
          Long answer : Cactus is meant to be a unit testing tool, meaning it
          lets you perform tests for a given method and then it lets you
          assert the result from that method.
        </P>
        <P align="justify">
          In the above scenario, a typical Cactus test will consist in
          verifying that the return HTTP response is an HTTP redirect (by
          checking the HTTP response code - 302 - in the <CODE><FONT face="courier, monospaced">endXXX()</FONT></CODE>
          method) and possibly also checking the URL of the redirect page.
        </P>
        <P align="justify">
          Then, as a second test, you could (if you wish) verify that calling
          the URL of the JSP does return such HTML content (using HttpUnit
          integration for example). Note that this second test is rather a
          functional test than a unit test but it can still be viewed as
          unit testing the <CODE><FONT face="courier, monospaced">doGet()</FONT></CODE> method of the JSP ...
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>

    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq5"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>The Ant runservertests task hangs when my server is started</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          When I use the <CODE><FONT face="courier, monospaced">runservertests</FONT></CODE> Cactus custom Ant task,
          it starts my server allright but then hangs and the tests are not
          executed. What is happening ?
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>
      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          It means that the <CODE><FONT face="courier, monospaced">testURL</FONT></CODE> attribute you've specified
          in <CODE><FONT face="courier, monospaced">runservertests</FONT></CODE> is not a valid URL. It must be a URL
          that is valid when the server is up. To diagnosis the problem simply
          open a browser once your server is started (i.e. when the task hangs)
          and type the URL in your browser. An alternative to debug is also to
          run Ant in debug mode (<CODE><FONT face="courier, monospaced">ant -debug [your target]</FONT></CODE>).
        </P>
        <P align="justify">
          With Cactus 1.3, the correct URL to call is the following, which is
          always valid :
          <CODE><FONT face="courier, monospaced">http://localhost:8080/webapp/ServletRedirector?Cactus_Service=RUN_TEST</FONT></CODE>.
          Of course replace <CODE><FONT face="courier, monospaced">webapp</FONT></CODE> by your webapp context and
          replace the port by the one you're using.
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>

    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq6"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>I'm getting a 'not a valid response' error message. What does it mean ?</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
         When I run my Cactus test, I'm getting the following :
        </P>

<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
testRequestDispatcherInclude(org.apache.cactus.sample.TestSampleServlet)
  org.apache.cactus.util.ChainedRuntimeException:

Not a valid response
  at
org.apache.cactus.client.WebTestResultParser.readRootElement(
  WebTestResultParser.java;org/apache/cactus/util/log/LogAspect.java(1k):134)
</PRE></TD></TR></TABLE></DIV>

      </FONT></TD></TR></TABLE></DIV><BR>
      <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
        <P align="justify">
          It means that Cactus could not connect to the server side properly.
          There could several reasons for this : a valid Redirector URL but
          not pointing to the Redirector, a secured resource, etc.
        </P>
        <P align="justify">
          To easiest way to diagnosis the problem is to enable Cactus logging
          (see the <A href="howto_config.html">Configuration Howto</A>
          for how to do this). The cactus client log
          (<CODE><FONT face="courier, monospaced">cactus_client.log</FONT></CODE> will clearly give the error).
        </P>
      </FONT></TD></TR></TABLE></DIV><BR>

    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq7"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>How to send multipart/form-data ?</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

        <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
          <P align="justify">
           How to send multipart/form-data to my servlet under test ?
          </P>
        </FONT></TD></TR></TABLE></DIV><BR>
        <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
          <P align="justify">
            One solution is to use the
            <A href="http://www.innovation.ch/java/HTTPClient/">HTTPClient</A>
            classes from Ronald Tschalar, as demonstrated in the following
            example :
          </P>

<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
import HTTPClient.Codecs;
import HTTPClient.NVPair;
.
.
.
NVPair[] hdrs = new NVPair[1];

public void beginUpload(WebRequest theRequest)
{
  NVPair[] opts = { new NVPair(&quot;option&quot;, &quot;myoption&quot;) };
  NVPair[] file = { new NVPair(&quot;comment&quot;, &quot;/home/alan/src.zip&quot;) };
  try {
    byte[] data = Codecs.mpFormDataEncode(opts, file, hdrs);
    InputStream i = new ByteArrayInputStream(data);
    theRequest.setUserData(i);
    theRequest.setContentType(hdrs[0].getValue());
    i.close();
  } catch (IOException e) {
    System.out.println(&quot;Error Building Multipart&quot;);
  }
}
</PRE></TD></TR></TABLE></DIV>

      </FONT></TD></TR></TABLE></DIV><BR>
    </FONT></TD></TR></TABLE></DIV><BR>

    <A name="faq8"><!--anchor--></A>
    <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="100%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+1"><B>I get a 'java.lang.ClassCastException: org.apache.commons.logging.impl.LogFactoryImpl' error when I use a JUnit TestRunner different from TextTestRunner</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>

        <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Question</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
          <P align="justify">
            Cactus tests run fine when I use the JUnit TextTestRunner but 
            fails with other runners like the SwingTestRunner. I get the
            following exception :
          </P>
<DIV align="center"><TABLE border="1" cellpadding="2" cellspacing="2"><TR><TD><PRE>
org.apache.commons.logging.LogConfigurationException:
java.lang.ClassCastException: org.apache.commons.logging.impl.LogFactoryImpl
at org.apache.commons.logging.LogFactory.newFactory(LogFactory.java:505)
at org.apache.commons.logging.LogFactory.getFactory(LogFactory.java:340)
at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:381) 	at
org.apache.cactus.AbstractTestCase.runBare(AbstractTestCase.java:188) 
</PRE></TD></TR></TABLE></DIV>

        </FONT></TD></TR></TABLE></DIV><BR>
        <DIV align="right"><TABLE border="0" cellpadding="2" cellspacing="0" width="98%"><TR><TD bgcolor="#525D76"><FONT color="#ffffff" face="arial,helvetica,sanserif" size="+0"><B>Solution</B></FONT></TD></TR><TR><TD><FONT color="#000000" face="arial,helvetica,sanserif"><BR>
          <P align="justify">
	        Check the 
	        <A href="http://junit.sourceforge.net/doc/faq/faq.htm#runners_1">JUnit 
	        FAQ</A>. Indeed, JUnit uses a special class loader to 
	        load classes that is incompatible with the Commons-Logging 
	        framework. Thus you need to put the commons-logging package in the
	        JUnit <CODE><FONT face="courier, monospaced">excluded.properties</FONT></CODE> file (see the JUnit FAQ).
		  </P>
		</FONT></TD></TR></TABLE></DIV><BR>

	</FONT></TD></TR></TABLE></DIV><BR>

  
</TD></TR></TABLE></TD></TR></TABLE><BR><TABLE border="0" cellpadding="0" cellspacing="0" width="100%"><TR><TD><HR noshade="" size="1"></TD></TR><TR><TD align="center"><FONT color="#525D76" face="arial,helvetica,sanserif" size="-1"><I>
                Copyright &copy; 2000-2002 The Apache Software Foundation.
                All Rights Reserved.
               </I></FONT></TD></TR></TABLE></BODY></HTML>